package WebGUI;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import util.Conn;

/**
 * Servlet implementation class HelloForm
 */
@WebServlet("/WebBrowser")
public class WebBrowser extends HttpServlet {
    private static final long serialVersionUID = 1L;
       
    
    /**
     * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
     */
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        // 设置响应内容类型
        response.setContentType("text/html;charset=UTF-8");
        List<Map> list =new ArrayList<Map>();//创建list集合用于存入map的键值对集合
        
        
        
        //插入数据
        Conn conn=new Conn() ;
        ResultSet rs;
        
        //判断是不是null
        String expertName=null;
        if(request.getParameter("name")!=null){
        	 expertName=new String(request.getParameter("name").getBytes("ISO-8859-1"),"utf-8");
        }
        if(expertName!=null){
        	rs=Conn.executeQuery("SELECT * FROM expertinfo WHERE n1='"+expertName+"'");	
        }else{
            rs=Conn.executeQuery("SELECT * FROM expertinfo");
        }
        
        try {
			while(rs.next()){
				Map map = new HashMap();
				
				map.put("n1", rs.getString("n1"));
				map.put("n2", rs.getString("n2"));
				map.put("n3", rs.getString("n3"));
				map.put("n4", rs.getString("n4"));
				map.put("n5", rs.getString("n5"));
				
				if(expertName==null){
					if(!rs.getString("n6").equals("")){
						map.put("n6", "ok");
					}else{
						map.put("n6", "-");
					}
					//
					if(!rs.getString("n7").equals("")){
						map.put("n7", "ok");
					}else{
						map.put("n7", "-");
					}
					//
					if(!rs.getString("n8").equals("")){
						map.put("n8", "ok");
					}else{
						map.put("n8", "-");
					}
					//
					if(!rs.getString("n9").equals("")){
						map.put("n9", "ok");
					}else{
						map.put("n9", "-");
					}
				}else{
					map.put("n6", rs.getString("n6"));
					map.put("n7", rs.getString("n7"));
					map.put("n8", rs.getString("n8"));
					map.put("n9", rs.getString("n9"));
				}
				
				map.put("n10", rs.getString("n10"));
				
				list.add(map);//在将map集合对象存入list集合
				
			}
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
        request.setAttribute("key_list",list);//
        if(expertName!=null){
        	request.getRequestDispatcher("/show.jsp").forward(request, response);
        }else{
        	request.getRequestDispatcher("/listall.jsp").forward(request, response);
        }
    }
   
    
    // 处理 POST 方法请求的方�?
    public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        doGet(request, response);
    }
}