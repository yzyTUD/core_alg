package reNew;

import java.io.BufferedWriter;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.FileWriter;
import java.io.IOException;
import java.io.InputStream;
import java.net.MalformedURLException;
import java.net.URL;
import java.net.URLConnection;

import org.jsoup.HttpStatusException;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;

import DataSer.ExpertChe;

import com.google.gson.Gson;

public class DownloadFile {
	public static  void main(String[] args) throws IOException{  
		int i=10;
		
		
		while(true){
			try {
				String url="http://www.x-mol.com/xmobile/tutor/getTutor?tutorId="+i;
			    Document doc=Jsoup.connect(url).ignoreContentType(true).timeout(50000).get();
			    Gson gson = new Gson();
				//JsonReader reader = new JsonReader(new FileReader("jsons/foo.json"));
				ExpertChe jsonDataObj = gson.fromJson(doc.text(), ExpertChe.class);
			    
			    
				downloadNet(new URL("https://xpic.x-mol.com/tutor%2FXMP000"+(i+2)+".jpg"),"pics/"+jsonDataObj.tutor.name+".jpg");
			    System.out.println("ok :"+i);
			    i++;
			}catch (FileNotFoundException e) {
				System.out.println("Invalid picsite: page "+i);
				i++;
			}catch (HttpStatusException e) {
			    System.out.println("Invalid website: page "+i);
			    i++;
			}
		}
	}

	public static void downloadNet(URL url,String name) throws IOException {
        // 下载网络文件
        int bytesum = 0;
        int byteread = 0;
            URLConnection conn = url.openConnection();
            InputStream inStream = conn.getInputStream();
            FileOutputStream fs = new FileOutputStream(name);

            byte[] buffer = new byte[1204];
            int length;
            while ((byteread = inStream.read(buffer)) != -1) {
                bytesum += byteread;
                fs.write(buffer, 0, byteread);
            }
    }
}
